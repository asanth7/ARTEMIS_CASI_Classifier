# Triage Architecture

## Overview

The triage system processes vulnerability reports through a 3-phase workflow, with each report getting its own dedicated triager instance for parallel processing.

## Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                SUPERVISOR                                       â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SupervisorToolsâ”‚    â”‚    Orchestrator  â”‚    â”‚    TriageManager            â”‚ â”‚
â”‚  â”‚                 â”‚    â”‚                  â”‚    â”‚                             â”‚ â”‚
â”‚  â”‚ submit() tool   â”‚â”€â”€â”€â”€â”¤ Routes based on  â”‚â”€â”€â”€â”€â”¤ Spawns individual           â”‚ â”‚
â”‚  â”‚ â€¢ benchmark     â”‚    â”‚ benchmark_mode:  â”‚    â”‚ triager instances           â”‚ â”‚
â”‚  â”‚   mode check    â”‚    â”‚                  â”‚    â”‚                             â”‚ â”‚
â”‚  â”‚ â€¢ route to      â”‚    â”‚ benchmark=true   â”‚    â”‚ Each vuln report gets       â”‚ â”‚
â”‚  â”‚   triage or     â”‚    â”‚ â””â”€â–º Direct Slack â”‚    â”‚ unique TriagerInstance      â”‚ â”‚
â”‚  â”‚   slack         â”‚    â”‚                  â”‚    â”‚                             â”‚ â”‚
â”‚  â”‚                 â”‚    â”‚ benchmark=false  â”‚    â”‚                             â”‚ â”‚
â”‚  â”‚                 â”‚    â”‚ â””â”€â–º Triage Queue â”‚    â”‚                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ vulnerability_data
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            TRIAGE INSTANCES                                    â”‚
â”‚                                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ TriagerInstance â”‚    â”‚ TriagerInstance â”‚    â”‚ TriagerInstance â”‚   ...       â”‚
â”‚  â”‚     ID: abc123  â”‚    â”‚     ID: def456  â”‚    â”‚     ID: ghi789  â”‚             â”‚
â”‚  â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚             â”‚
â”‚  â”‚ Session Dir:    â”‚    â”‚ Session Dir:    â”‚    â”‚ Session Dir:    â”‚             â”‚
â”‚  â”‚ triage_instancesâ”‚    â”‚ triage_instancesâ”‚    â”‚ triage_instancesâ”‚             â”‚
â”‚  â”‚ /triager_abc123 â”‚    â”‚ /triager_def456 â”‚    â”‚ /triager_ghi789 â”‚             â”‚
â”‚  â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚             â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚             â”‚
â”‚  â”‚ â”‚ TriageTools â”‚ â”‚    â”‚ â”‚ TriageTools â”‚ â”‚    â”‚ â”‚ TriageTools â”‚ â”‚             â”‚
â”‚  â”‚ â”‚ â€¢ Phase mgmtâ”‚ â”‚    â”‚ â”‚ â€¢ Phase mgmtâ”‚ â”‚    â”‚ â”‚ â€¢ Phase mgmtâ”‚ â”‚             â”‚
â”‚  â”‚ â”‚ â€¢ Spawn 1   â”‚ â”‚    â”‚ â”‚ â€¢ Spawn 1   â”‚ â”‚    â”‚ â”‚ â€¢ Spawn 1   â”‚ â”‚             â”‚
â”‚  â”‚ â”‚   codex instâ”‚ â”‚    â”‚ â”‚   codex instâ”‚ â”‚    â”‚ â”‚   codex instâ”‚ â”‚             â”‚
â”‚  â”‚ â”‚ â€¢ TaskRouterâ”‚ â”‚    â”‚ â”‚ â€¢ TaskRouterâ”‚ â”‚    â”‚ â”‚ â€¢ TaskRouterâ”‚ â”‚             â”‚
â”‚  â”‚ â”‚ â€¢ Validationâ”‚ â”‚    â”‚ â”‚ â€¢ Validationâ”‚ â”‚    â”‚ â”‚ â€¢ Validationâ”‚ â”‚             â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3-Phase Triage Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             PHASE FLOW                                          â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚    PHASE 1      â”‚         â”‚    PHASE 2      â”‚         â”‚    PHASE 3      â”‚    â”‚
â”‚  â”‚ Initial Review  â”‚         â”‚   Validation    â”‚         â”‚ Severity Assess â”‚    â”‚ 
â”‚  â”‚                 â”‚         â”‚  & Reproduction â”‚         â”‚                 â”‚    â”‚
â”‚  â”‚ â€¢ Analyze reportâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ â€¢ Spawn codex   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ â€¢ CVSS scoring  â”‚    â”‚
â”‚  â”‚ â€¢ Check quality â”‚         â”‚ â€¢ Reproduce bug â”‚         â”‚ â€¢ Impact analysisâ”‚   â”‚
â”‚  â”‚ â€¢ Validate scopeâ”‚         â”‚ â€¢ Document proofâ”‚         â”‚ â€¢ Final classifyâ”‚    â”‚
â”‚  â”‚                 â”‚         â”‚ â€¢ Gather evidenceâ”‚        â”‚                â”‚   â”‚
â”‚  â”‚ Decision:       â”‚         â”‚                 â”‚         â”‚ Output:         â”‚   â”‚
â”‚  â”‚ PROCEED/REJECT  â”‚         â”‚ Decision:       â”‚         â”‚ Critical/High/  â”‚   â”‚
â”‚  â”‚                 â”‚         â”‚ REPRODUCED/     â”‚         â”‚ Medium/Low      â”‚   â”‚
â”‚  â”‚                 â”‚         â”‚ NOT_REPRODUCED  â”‚         â”‚ + CVSS Score    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                           â”‚                           â”‚             â”‚
â”‚           â”‚ REJECT                    â”‚ NOT_REPRODUCED            â”‚ SUCCESS     â”‚
â”‚           â–¼                           â–¼                           â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   REJECTION     â”‚         â”‚  REPRODUCTION   â”‚         â”‚   COMPLETION    â”‚   â”‚
â”‚  â”‚   FEEDBACK      â”‚         â”‚    FAILURE      â”‚         â”‚                 â”‚   â”‚
â”‚  â”‚                 â”‚         â”‚   FEEDBACK      â”‚         â”‚ â€¢ Send to Slack â”‚   â”‚
â”‚  â”‚ â€¢ Write feedbackâ”‚         â”‚                 â”‚         â”‚ â€¢ Launch        â”‚   â”‚
â”‚  â”‚ â€¢ Notify        â”‚         â”‚ â€¢ Write feedbackâ”‚         â”‚   InternalVeri- â”‚   â”‚
â”‚  â”‚   supervisor    â”‚         â”‚ â€¢ Provide       â”‚         â”‚   fier (future) â”‚   â”‚
â”‚  â”‚ â€¢ Terminate     â”‚         â”‚   suggestions   â”‚         â”‚ â€¢ Success       â”‚   â”‚
â”‚  â”‚                 â”‚         â”‚ â€¢ Notify        â”‚         â”‚   feedback      â”‚   â”‚
â”‚  â”‚                 â”‚         â”‚   supervisor    â”‚         â”‚                 â”‚   â”‚
â”‚  â”‚                 â”‚         â”‚ â€¢ Terminate     â”‚         â”‚                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Structure

```
supervisor/
â”œâ”€â”€ orchestration/
â”‚   â”œâ”€â”€ orchestrator.py          # Main supervisor logic
â”‚   â”œâ”€â”€ instance_manager.py      # Codex instance management
â”‚   â””â”€â”€ router.py               # TaskRouter for specialist selection
â”œâ”€â”€ tools.py                    # SupervisorTools (submit routing)
â””â”€â”€ triage/
    â”œâ”€â”€ triage_manager.py       # TriageManager + TriagerInstance
    â”œâ”€â”€ triage_tools.py         # TriageTools (phase mgmt + validation)
    â””â”€â”€ prompts/
        â”œâ”€â”€ system_prompt.py    # Single system prompt for all phases
        â”œâ”€â”€ initial_review_prompt.py  # Phase 1 user prompt
        â”œâ”€â”€ validation_prompt.py      # Phase 2 user prompt
        â””â”€â”€ severity_prompt.py        # Phase 3 user prompt
```

## Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DATA FLOW                                          â”‚
â”‚                                                                                 â”‚
â”‚  Vulnerability Report                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                           â”‚
â”‚  â”‚ {               â”‚                                                           â”‚
â”‚  â”‚   title: str    â”‚                                                           â”‚
â”‚  â”‚   asset: str    â”‚                                                           â”‚
â”‚  â”‚   vuln_type: strâ”‚                                                           â”‚
â”‚  â”‚   severity: str â”‚                                                           â”‚
â”‚  â”‚   description  â”‚                                                            â”‚
â”‚  â”‚   repro_steps  â”‚                                                            â”‚
â”‚  â”‚   impact       â”‚                                                            â”‚
â”‚  â”‚   cleanup      â”‚                                                            â”‚
â”‚  â”‚ }              â”‚                                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                           â”‚
â”‚           â”‚                                                                     â”‚
â”‚           â–¼                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                           â”‚
â”‚  â”‚ submit() tool   â”‚                                                           â”‚
â”‚  â”‚ â€¢ Check mode    â”‚                                                           â”‚
â”‚  â”‚ â€¢ Route request â”‚                                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                           â”‚
â”‚           â”‚                                                                     â”‚
â”‚           â–¼                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                           â”‚
â”‚  â”‚ TriageManager   â”‚                                                           â”‚
â”‚  â”‚ â€¢ Generate ID   â”‚                                                           â”‚
â”‚  â”‚ â€¢ Create dir    â”‚                                                           â”‚
â”‚  â”‚ â€¢ Spawn triager â”‚                                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                           â”‚
â”‚           â”‚                                                                     â”‚
â”‚           â–¼                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚  â”‚ TriagerInstance â”‚ â”€â”€â”€â”€â”€â”€â–¶ â”‚ Feedback Files  â”‚                              â”‚
â”‚  â”‚ â€¢ Run phases    â”‚         â”‚                 â”‚                              â”‚
â”‚  â”‚ â€¢ Tool calls    â”‚         â”‚ supervisor_      â”‚                              â”‚
â”‚  â”‚ â€¢ Log progress  â”‚         â”‚ feedback.txt     â”‚                              â”‚
â”‚  â”‚ â€¢ Generate      â”‚         â”‚                 â”‚                              â”‚
â”‚  â”‚   feedback      â”‚         â”‚ â€¢ Read by       â”‚                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   supervisor    â”‚                              â”‚
â”‚                               â”‚ â€¢ Auto-deleted  â”‚                              â”‚
â”‚                               â”‚   after read    â”‚                              â”‚
â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Feedback Loop

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            FEEDBACK SYSTEM                                      â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚   TRIAGER       â”‚                    â”‚   SUPERVISOR    â”‚                    â”‚
â”‚  â”‚   INSTANCE      â”‚                    â”‚                 â”‚                    â”‚
â”‚  â”‚                 â”‚                    â”‚                 â”‚                    â”‚
â”‚  â”‚ 1. Process vuln â”‚                    â”‚ 1. Check for    â”‚                    â”‚
â”‚  â”‚ 2. Complete     â”‚                    â”‚    feedback     â”‚                    â”‚
â”‚  â”‚    triage       â”‚                    â”‚    files        â”‚                    â”‚
â”‚  â”‚ 3. Write        â”‚ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â–¶ â”‚ 2. Read content â”‚                    â”‚
â”‚  â”‚    feedback     â”‚   feedback file    â”‚ 3. Add to user  â”‚                    â”‚
â”‚  â”‚    file         â”‚                    â”‚    message      â”‚                    â”‚
â”‚  â”‚                 â”‚                    â”‚ 4. Delete file  â”‚                    â”‚
â”‚  â”‚ Session Dir:    â”‚                    â”‚                 â”‚                    â”‚
â”‚  â”‚ /triager_abc/   â”‚                    â”‚ Feedback loop   â”‚                    â”‚
â”‚  â”‚ supervisor_     â”‚                    â”‚ in main         â”‚                    â”‚
â”‚  â”‚ feedback.txt    â”‚                    â”‚ iteration       â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                                 â”‚
â”‚  Feedback Types:                                                               â”‚
â”‚  â€¢ âœ… Successful triage + classification                                       â”‚
â”‚  â€¢ âŒ Rejection (Phase 1)                                                      â”‚
â”‚  â€¢ ğŸ” Unable to reproduce (Phase 2)                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Instance Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CODEX INSTANCE SPAWNING                                 â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚   TRIAGER       â”‚                    â”‚   TASKROUTER    â”‚                    â”‚
â”‚  â”‚                 â”‚                    â”‚                 â”‚                    â”‚
â”‚  â”‚ spawn_codex()   â”‚ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â–¶ â”‚ â€¢ Analyze task  â”‚                    â”‚
â”‚  â”‚ tool call       â”‚   task_description â”‚ â€¢ Select        â”‚                    â”‚
â”‚  â”‚                 â”‚                    â”‚   specialist    â”‚                    â”‚
â”‚  â”‚ Max 1 instance  â”‚ â—€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”‚ â€¢ Return choice â”‚                    â”‚
â”‚  â”‚ per triager     â”‚   specialist name  â”‚                 â”‚                    â”‚
â”‚  â”‚                 â”‚                    â”‚ Specialists:    â”‚                    â”‚
â”‚  â”‚ Guard logic     â”‚                    â”‚ â€¢ web           â”‚                    â”‚
â”‚  â”‚ prevents        â”‚                    â”‚ â€¢ linux-privesc â”‚                    â”‚
â”‚  â”‚ multiple        â”‚                    â”‚ â€¢ windows-privescâ”‚                   â”‚
â”‚  â”‚ spawns          â”‚                    â”‚ â€¢ enumeration   â”‚                    â”‚
â”‚  â”‚                 â”‚                    â”‚ â€¢ client-side-webâ”‚                   â”‚
â”‚  â”‚                 â”‚                    â”‚ â€¢ active-directoryâ”‚                  â”‚
â”‚  â”‚                 â”‚                    â”‚ â€¢ shelling      â”‚                    â”‚
â”‚  â”‚                 â”‚                    â”‚ â€¢ web-enumerationâ”‚                   â”‚
â”‚  â”‚                 â”‚                    â”‚ â€¢ generalist    â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚           â”‚                                       â”‚                            â”‚
â”‚           â–¼                                       â”‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚                            â”‚
â”‚  â”‚ InstanceManager â”‚ â—€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”˜                            â”‚
â”‚  â”‚                 â”‚                                                           â”‚
â”‚  â”‚ â€¢ Spawn codex   â”‚                                                           â”‚
â”‚  â”‚   with specialist                                                           â”‚
â”‚  â”‚   mode          â”‚                                                           â”‚
â”‚  â”‚ â€¢ Monitor       â”‚                                                           â”‚
â”‚  â”‚   instance      â”‚                                                           â”‚
â”‚  â”‚ â€¢ Handle        â”‚                                                           â”‚
â”‚  â”‚   followups     â”‚                                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Conversation Logging

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            LOGGING SYSTEM                                       â”‚
â”‚                                                                                 â”‚
â”‚  TriagerInstance Session Directory: /triage_instances/triager_abc123/           â”‚
â”‚                                                                                 â”‚
â”‚  â”œâ”€â”€ triage_conversation.log        # Human-readable conversation log          â”‚
â”‚  â”œâ”€â”€ conversation_history.json      # Structured OpenAI format                â”‚
â”‚  â”œâ”€â”€ supervisor_feedback.txt        # Feedback for supervisor                  â”‚
â”‚  â”œâ”€â”€ triage_findings.log           # Phase findings and evidence               â”‚
â”‚  â”œâ”€â”€ phase_completions.json        # Phase completion tracking                 â”‚
â”‚  â””â”€â”€ workspaces/                   # Codex instance workspaces                â”‚
â”‚      â””â”€â”€ reproduction_test/        # Example workspace for spawned instance    â”‚
â”‚                                                                                 â”‚
â”‚  Conversation Flow:                                                             â”‚
â”‚  1. System prompt (explains 3 phases)                                          â”‚
â”‚  2. Phase 1 user prompt (with vuln data)                                       â”‚
â”‚  3. Assistant response + tool calls                                             â”‚
â”‚  4. Tool results                                                               â”‚
â”‚  5. finished_phase_1 tool call                                                 â”‚
â”‚  6. Phase 2 user prompt (if PROCEED)                                           â”‚
â”‚  7. ... (repeat for phases 2-3)                                               â”‚
â”‚                                                                                 â”‚
â”‚  Logs capture:                                                                 â”‚
â”‚  â€¢ All LLM interactions                                                        â”‚
â”‚  â€¢ Tool executions and results                                                â”‚
â”‚  â€¢ Phase transitions                                                           â”‚
â”‚  â€¢ Codex instance spawning/management                                          â”‚
â”‚  â€¢ Final decision and reasoning                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Benchmark Mode

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            BENCHMARK MODE                                       â”‚
â”‚                                                                                 â”‚
â”‚  CLI: ./supervisor --benchmark-mode                                            â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   submit()      â”‚         â”‚   Benchmark     â”‚         â”‚   Direct to     â”‚   â”‚
â”‚  â”‚   tool called   â”‚         â”‚   Mode Check    â”‚         â”‚   Slack         â”‚   â”‚
â”‚  â”‚                 â”‚ â”€â”€â”€â”€â”€â”€â–¶ â”‚                 â”‚ â”€â”€â”€â”€â”€â”€â–¶ â”‚                 â”‚   â”‚
â”‚  â”‚ Vuln report     â”‚         â”‚ if benchmark:   â”‚         â”‚ Skip triage     â”‚   â”‚
â”‚  â”‚ payload         â”‚         â”‚   skip_triage() â”‚         â”‚ Skip verificationâ”‚   â”‚
â”‚  â”‚                 â”‚         â”‚ else:           â”‚         â”‚ Direct submit   â”‚   â”‚
â”‚  â”‚                 â”‚         â”‚   triage()      â”‚         â”‚                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                       â”‚                                         â”‚
â”‚                                       â–¼                                         â”‚
â”‚                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                               â”‚   Normal Mode   â”‚                              â”‚
â”‚                               â”‚                 â”‚                              â”‚
â”‚                               â”‚ Route to        â”‚                              â”‚
â”‚                               â”‚ TriageManager   â”‚                              â”‚
â”‚                               â”‚ for processing  â”‚                              â”‚
â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                                 â”‚
â”‚  Purpose: Testing and debugging without triage overhead                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Design Principles

1. **Isolation**: Each vulnerability report gets its own triager instance
2. **Parallel Processing**: Multiple triages can run simultaneously
3. **Resource Limits**: Each triager limited to 1 codex instance maximum
4. **Specialist Selection**: TaskRouter selects appropriate codex specialist
5. **Feedback Loop**: File-based communication back to supervisor
6. **Phase Management**: Structured 3-phase workflow with clear transitions
7. **Dual Logging**: Both human-readable and structured conversation logs
8. **Benchmark Mode**: Bypass for testing/debugging scenarios